# Starter pipeline

# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

jobs:
- job: Windows
  pool:
    vmImage: windows-2022

  steps:
  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: |
        wget https://github.com/premake/premake-core/releases/download/v5.0.0-beta1/premake-5.0.0-beta1-windows.zip -OutFile $(Build.SourcesDirectory)/premake.zip
        Expand-Archive -Force premake.zip $(Build.SourcesDirectory)/build/
      failOnStderr: true
  - task: CmdLine@2
    inputs:
      script: |
        cd build
        dir
        $(Build.SourcesDirectory)\premake\premake5.exe vs2022
      failOnStderr: true
  - task: MSBuild@1
    inputs:
      solution: 'build/rive.sln'
      msbuildArchitecture: 'x64'
      configuration: 'Release'
  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: 'Copy-Item $(Build.SourcesDirectory)\build\windows\bin\release\rive.dll -Destination $(Build.SourcesDirectory)\runtimes\win-x64\native\rive.dll'
  - task: MSBuild@1
    inputs:
      solution: 'build/rive.sln'
      msbuildArchitecture: 'x86'
      configuration: 'Release'
  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: 'Copy-Item $(Build.SourcesDirectory)\build\windows\bin\release\rive.dll -Destination $(Build.SourcesDirectory)\runtimes\win-x86\native\rive.dll'